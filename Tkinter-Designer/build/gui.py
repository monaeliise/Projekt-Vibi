# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer


from pathlib import Path
from tkinter import Tk, Button, PhotoImage
from tkinter import Tk, Canvas, Button, PhotoImage, Label, Entry, messagebox, Text, Toplevel
import os, random, glob, time, pygame, vlc

OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = OUTPUT_PATH / Path(r"/Users/mona/Desktop/Tkinter-Designer-master/Tkinter-Designer/build/assets/frame0")


def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)


# akna loomine
window = Tk()

window.geometry("650x506")
window.configure(bg = "#FFFFFF")


canvas = Canvas(
    window,
    bg = "#FFFFFF",
    height = 506,
    width = 650,
    bd = 0,
    highlightthickness = 0,
    relief = "ridge"
)

canvas.place(x = 0, y = 0)
image_image_1 = PhotoImage(
    file=relative_to_assets("image_1.png"))
image_1 = canvas.create_image(
    325.0,
    253.0,
    image=image_image_1
)



### Et raadiod samal ajal ei mängiks
mängija = vlc.Instance("--no-xlib").media_player_new()
viimati_vajutatud_nupp = None  # Hoiab meeles viimati vajutatud nuppu

# Funktsioon raadiojaama mängimiseks, peatamiseks kui nupule uuesti vajutada
def mängi_raadiojaama(url, nupp):
    global viimati_vajutatud_nupp
    if viimati_vajutatud_nupp == nupp:
        # Kui sama nuppu vajutatakse uuesti, siis peata raadio
        mängija.stop()
        viimati_vajutatud_nupp = None
        nupp.config(relief="flat")
    else:
        # Kui vajutatakse uut nuppu, mängi vastavat raadiojaama
        if viimati_vajutatud_nupp is not None:
            viimati_vajutatud_nupp.config(relief="flat")
        mängija.set_media(vlc.Instance().media_new(url))
        mängija.play()
        viimati_vajutatud_nupp = nupp
        nupp.config(relief="sunken")



# Dance FM
    
def dancefm():
        url = "http://ec1.yesstreaming.net:2570/stream"
        # mängija = vlc.Instance("--no-xlib")     
        # mängija = vlc.Instance()
        # meediapleier = mängija.media_player_new()
        # meedia = mängija.media_new(url)
        # meedia.get_mrl()
        # meediapleier.set_media(meedia)
        # meediapleier.play()
        mängi_raadiojaama(url, button_3)

def nupu_1_klikk():
    print("Kuulate Dance FM raadiojaama!")
    dancefm() 

button_image_1 = PhotoImage(
    file=relative_to_assets("button_1.png"))
button_1 = Button(
    image=button_image_1,
    borderwidth=0,
    highlightthickness=0,
    command=nupu_1_klikk,
    relief="flat"
)
button_1.place(
    x=47.0,
    y=387.0,
    width=148.0,
    height=25.0
)

# Vikerraadio

def vikerraadio():
        url = "http://icecast.err.ee/vikerraadio.mp3"    
        # mängija = vlc.Instance()
        # meediapleier = mängija.media_player_new()
        # meedia = mängija.media_new(url)
        # meedia.get_mrl()
        # meediapleier.set_media(meedia)
        # meediapleier.play()
        mängi_raadiojaama(url, button_2)

def nupu_2_klikk():
    print("Kuulate Vikerraadio raadiojaama! :)")
    vikerraadio() 

button_image_2 = PhotoImage(
    file=relative_to_assets("button_2.png"))
button_2 = Button(
    image=button_image_2,
    borderwidth=0,
    highlightthickness=0,
    command=nupu_2_klikk,
    relief="flat"
)
button_2.place(
    x=47.0,
    y=320.0,
    width=148.0,
    height=25.0
)


# Nõmme raadio

def nommeraadio():
        url = "http://149.210.138.12:8000/nommeraadio"    
        mängija = vlc.Instance()
        meediapleier = mängija.media_player_new()
        meedia = mängija.media_new(url)
        meedia.get_mrl()
        meediapleier.set_media(meedia)
        meediapleier.play()
        mängi_raadiojaama(url, button_3)


def nupu_3_klikk():
    print("Kuulate Nõmme raadiojaama! :)")
    vikerraadio() 

button_image_3 = PhotoImage(
    file=relative_to_assets("button_3.png"))
button_3 = Button(
    image=button_image_3,
    borderwidth=0,
    highlightthickness=0,
    command=nupu_3_klikk,
    relief="flat"
)

button_3.place(
    x=45.0,
    y=253.0,
    width=177.0,
    height=25.0
)


# Loo juhuslik esitusloend

def avan_playlist_gui():
    playlist_window = Toplevel(window)
    playlist_gui = PlaylistGUI(playlist_window)

class PlaylistGUI:
    def __init__(self, master):
        self.master = master
        master.title("Juhuslik Esitusloend")

        self.label_zhanr = Label(master, text="Sisesta laulude žanr (bluus, chopped and screwed, ooper, räpp või rokk):")
        self.label_zhanr.pack()

        self.zhanr_entry = Entry(master, width=30)
        self.zhanr_entry.pack()

        self.label_kogus = Label(master, text="Sisesta esitusloendi laulude arv:")
        self.label_kogus.pack()

        self.kogus_entry = Entry(master, width=30)
        self.kogus_entry.pack()

        self.loo_nupp = Button(master, text="Loo Esitusloend", command=self.loo_esisusloend)
        self.loo_nupp.pack()

        self.pause_nupp = Button(master, text="Stopp", command=self.pause_resume_muusika)
        self.pause_nupp.pack()
        self.pause_flag = False

        # Uued Label objektid laulu ja playlisti info kuvamiseks
        self.laulu_info_label = Label(master, text="Hetkel mängib: -")
        self.laulu_info_label.pack()

        self.playlist_info_label = Label(master, text="Playlist: -")
        self.playlist_info_label.pack()

    def pause_resume_muusika(self):
        self.pause_flag = not self.pause_flag

        if self.pause_flag:
            pygame.mixer.music.pause()
        else:
            pygame.mixer.music.unpause()

    def loo_esisusloend(self):
        zhanr = self.zhanr_entry.get()
        kogus_laulud = self.kogus_entry.get()

        if not zhanr or not kogus_laulud.isdigit():
            messagebox.showerror("Viga", "Palun sisesta sobivad sisendid.")
            return

        kogus_laulud = int(kogus_laulud)

        laulude_kataloog = os.path.join(os.getcwd(), "laulud", zhanr)
        self.mängi_muusikat(laulude_kataloog, kogus_laulud)

    def stop_muusika(self):
        # Set the stop flag to True
        self.stop_flag = False
        # Close the window when stopping
        self.master.destroy()

    import os

# ...

    def mängi_muusikat(self, laulude_kataloog, kogus_laulud):
        pygame.init()
        mp3_failid = glob.glob(os.path.join(laulude_kataloog, '*.mp3'))

        if not mp3_failid:
            print(f"Kataloogis '{laulude_kataloog}' ei leitud ühtegi mp3 faili.")
            return

        random.shuffle(mp3_failid)
        valitud_laulud = mp3_failid[:kogus_laulud]

    # Uuendage laulu ja playlisti infot
        self.laulu_info_label.config(text="Hetkel mängib: -")
        playlist_nimi = ', '.join(os.path.basename(laulu_tee) for laulu_tee in valitud_laulud)
        self.playlist_info_label.config(text=f"Playlist: {playlist_nimi}")

        for laulu_tee in valitud_laulud:
            laulu_nimi = os.path.basename(laulu_tee)
            self.laulu_info_label.config(text=f"Hetkel mängib: {laulu_nimi}")
            print(f"Mängib: {laulu_nimi}")

            pygame.mixer.music.load(laulu_tee)
            pygame.mixer.music.play()

            while pygame.mixer.music.get_busy() and not self.stop_flag and not self.pause_flag:
                pygame.time.Clock().tick(5)

            if self.stop_flag:
                pygame.mixer.music.stop()
                break

    # Taasta algseis
        self.laulu_info_label.config(text="Hetkel mängib: -")
        self.playlist_info_label.config(text="Playlist: -")

        pygame.quit()



button_image_4 = PhotoImage(
    file=relative_to_assets("button_4.png"))
button_4 = Button(
    image=button_image_4,
    borderwidth=0,
    highlightthickness=0,
    command=avan_playlist_gui,
    relief="flat"
)
button_4.place(
    x=47.0,
    y=186.0,
    width=269.0,
    height=25.0
)

# Tiiteltekst
image_image_2 = PhotoImage(
    file=relative_to_assets("image_2.png"))
image_2 = canvas.create_image(
    307.0,
    268.0,
    image=image_image_2
)
window.resizable(False, False)
window.mainloop()
