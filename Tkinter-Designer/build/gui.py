
# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer


from pathlib import Path
from tkinter import Tk, Button, PhotoImage
import os, random, glob, time, pygame, vlc
from PIL import Image, ImageTk


# from tkinter import *
# Explicit imports to satisfy Flake8
from tkinter import Tk, Canvas, Button, PhotoImage, Label, Entry, messagebox, Text, Toplevel


OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = OUTPUT_PATH / Path(r"/Users/mona/Desktop/Tkinter-Designer-master/Tkinter-Designer/build/assets/frame0")


def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)


# akna loomine
window = Tk()

window.geometry("650x506")
window.configure(bg = "#FFFFFF")


canvas = Canvas(
    window,
    bg = "#FFFFFF",
    height = 506,
    width = 650,
    bd = 0,
    highlightthickness = 0,
    relief = "ridge"
)

canvas.place(x = 0, y = 0)
image_image_1 = PhotoImage(
    file=relative_to_assets("image_1.png"))
image_1 = canvas.create_image(
    325.0,
    253.0,
    image=image_image_1
)


### Et raadiod samal ajal ei mängiks
mängija = vlc.Instance("--no-xlib").media_player_new()
viimati_vajutatud_nupp = None  # Hoiab meeles viimati vajutatud nuppu

# Funktsioon raadiojaama mängimiseks
def mängi_raadiojaama(url, nupp):
    global viimati_vajutatud_nupp
    if viimati_vajutatud_nupp is not None:
        viimati_vajutatud_nupp.config(relief="flat")  
    mängija.set_media(vlc.Instance().media_new(url))
    mängija.play()
    viimati_vajutatud_nupp = nupp  # määra viimati vajutatud nupp uueks nupuks


# Dance FM
    
def dancefm():
        url = "http://ec1.yesstreaming.net:2570/stream"
        # mängija = vlc.Instance("--no-xlib")     
        # mängija = vlc.Instance()
        # meediapleier = mängija.media_player_new()
        # meedia = mängija.media_new(url)
        # meedia.get_mrl()
        # meediapleier.set_media(meedia)
        # meediapleier.play()
        mängi_raadiojaama(url, button_3)

def nupu_1_klikk():
    print("Kuulate Dance FM raadiojaama!")
    dancefm() 

button_image_1 = PhotoImage(
    file=relative_to_assets("button_1.png"))
button_1 = Button(
    image=button_image_1,
    borderwidth=0,
    highlightthickness=0,
    command=nupu_1_klikk,
    relief="flat"
)
button_1.place(
    x=47.0,
    y=387.0,
    width=148.0,
    height=25.0
)

# Vikerraadio

def vikerraadio():
        url = "http://icecast.err.ee/vikerraadio.mp3"    
        # mängija = vlc.Instance()
        # meediapleier = mängija.media_player_new()
        # meedia = mängija.media_new(url)
        # meedia.get_mrl()
        # meediapleier.set_media(meedia)
        # meediapleier.play()
        mängi_raadiojaama(url, button_4)

def nupu_2_klikk():
    print("Kuulate Vikerraadio raadiojaama! :)")
    vikerraadio() 

button_image_2 = PhotoImage(
    file=relative_to_assets("button_2.png"))
button_2 = Button(
    image=button_image_2,
    borderwidth=0,
    highlightthickness=0,
    command=nupu_2_klikk,
    relief="flat"
)
button_2.place(
    x=47.0,
    y=320.0,
    width=148.0,
    height=25.0
)


# Nõmme raadio

def nommeraadio():
        url = "http://149.210.138.12:8000/nommeraadio"    
        mängija = vlc.Instance()
        meediapleier = mängija.media_player_new()
        meedia = mängija.media_new(url)
        meedia.get_mrl()
        meediapleier.set_media(meedia)
        meediapleier.play()

def nupu_3_klikk():
    print("Kuulate Nõmme raadiojaama! :)")
    vikerraadio() 

button_image_3 = PhotoImage(
    file=relative_to_assets("button_3.png"))
button_3 = Button(
    image=button_image_3,
    borderwidth=0,
    highlightthickness=0,
    command=nupu_3_klikk,
    relief="flat"
)

button_3.place(
    x=45.0,
    y=253.0,
    width=177.0,
    height=25.0
)


# Loo juhuslik esitusloend

def avan_playlist_gui():
    playlist_window = Toplevel(window)
    playlist_gui = PlaylistGUI(playlist_window)


button_image_4 = PhotoImage(
    file=relative_to_assets("button_4.png"))
button_4 = Button(
    image=button_image_4,
    borderwidth=0,
    highlightthickness=0,
    command=avan_playlist_gui,
    relief="flat"
)
button_4.place(
    x=47.0,
    y=186.0,
    width=269.0,
    height=25.0
)


class PlaylistGUI:
    def __init__(self, master):
        self.master = master
        master.title("Juhuslik Esitusloend")

        self.label_zhanr = Label(master, text="Sisesta laulude žanr:")
        self.label_zhanr.pack()

        self.zhanr_entry = Entry(master, width=30)
        self.zhanr_entry.pack()

        self.label_kogus = Label(master, text="Sisesta esitusloendi laulude arv:")
        self.label_kogus.pack()

        self.kogus_entry = Entry(master, width=30)
        self.kogus_entry.pack()

        self.loo_nupp = Button(master, text="Loo Esitusloend", command=self.loo_esisusloend)
        self.loo_nupp.pack()

    def loo_esisusloend(self):
        zhanr = self.zhanr_entry.get()
        kogus_laulud = self.kogus_entry.get()

        if not zhanr or not kogus_laulud.isdigit():
            messagebox.showerror("Viga", "Palun sisesta sobivad sisendid.")
            return

        kogus_laulud = int(kogus_laulud)

        self.master.destroy()  # Sulge aken pärast andmete kogumist

        laulude_kataloog = os.path.join(os.getcwd(), "laulud", zhanr)
        self.mängi_muusikat(laulude_kataloog, kogus_laulud)

    def mängi_muusikat(self, laulude_kataloog, kogus_laulud):
        pygame.init()
        mp3_failid = glob.glob(os.path.join(laulude_kataloog, '*.mp3'))

        if not mp3_failid:
            print(f"Kataloogis '{laulude_kataloog}' ei leitud ühtegi mp3 faili.")
            return

        random.shuffle(mp3_failid)
        valitud_laulud = mp3_failid[:kogus_laulud]

        for laul in valitud_laulud:
            print(f"Mängib: {laul}")

            pygame.mixer.music.load(laul)
            pygame.mixer.music.play()

            while pygame.mixer.music.get_busy():
                pygame.time.Clock().tick(5)

        pygame.quit()




# Tiitel
image_image_2 = PhotoImage(
    file=relative_to_assets("image_2.png"))
image_2 = canvas.create_image(
    307.0,
    268.0,
    image=image_image_2
)
window.resizable(False, False)
window.mainloop()
